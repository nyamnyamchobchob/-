import random
import pandas as pd

# ì—‘ì…€ ë¶ˆëŸ¬ì˜¤ê¸°
df = pd.read_excel("fbfd2501-4759-4a72-96a6-beb58da701ea.xlsx")

# quiz_data ë§Œë“¤ê¸° (dict êµ¬ì¡°: {keyword: [data1, data2, ...]})
quiz_data = {}
for _, row in df.iterrows():
    keyword = row["keyword"]
    data = str(row["data"]).split(",") if "," in str(row["data"]) else [str(row["data"])]
    data = [d.strip() for d in data]  # ê³µë°± ì œê±°
    if keyword not in quiz_data:
        quiz_data[keyword] = []
    quiz_data[keyword].extend(data)

# ì´ˆì„± ë³€í™˜ í•¨ìˆ˜
def get_initials(word):
    CHOSUNG_LIST = [
        'ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ',
        'ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…'
    ]
    result = ""
    for char in word:
        if 'ê°€' <= char <= 'í£':
            code = ord(char) - ord('ê°€')
            chosung = code // 588
            result += CHOSUNG_LIST[chosung]
        else:
            result += char
    return result

# ë¬¸ì œ ì¶œì œ í•¨ìˆ˜
def ask_question():
    q_type = random.choice(["ì´ˆì„±ë¬¸ì œ", "ì¼ì¹˜ë¬¸ì œ"])  # ë¬¸ì œ ìœ í˜• ëœë¤ ì„ íƒ
    keyword = random.choice(list(quiz_data.keys()))
    datas = quiz_data[keyword]

    if q_type == "ì´ˆì„±ë¬¸ì œ":
        answer = random.choice(datas)
        initials = get_initials(answer)
        print(f"[ì´ˆì„±ë¬¸ì œ] ë‹¤ìŒ ì´ˆì„±ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€? {initials}")
        user = input("ğŸ‘‰ ì •ë‹µ ì…ë ¥: ")
        if user.strip() == answer:
            print("âœ… ì •ë‹µ!")
            return True
        else:
            print(f"âŒ ì˜¤ë‹µ! ì •ë‹µì€ {answer}")
            return False

    else:  # ì¼ì¹˜ë¬¸ì œ
        # ì •ë‹µ í›„ë³´ ë³µìˆ˜ ê°€ëŠ¥
        correct_answers = random.sample(datas, random.randint(1, len(datas)))
        options = correct_answers.copy()

        # ì˜¤ë‹µ í›„ë³´ ì„ê¸°
        while len(options) < 4:
            wrong_keyword = random.choice(list(quiz_data.keys()))
            wrong_data = random.choice(quiz_data[wrong_keyword])
            if wrong_data not in options:
                options.append(wrong_data)

        random.shuffle(options)

        print(f"[ì¼ì¹˜ë¬¸ì œ] '{keyword}'ì— í•´ë‹¹í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?")
        for i, opt in enumerate(options, 1):
            print(f"{i}. {opt}")

        user_input = input("ğŸ‘‰ ë²ˆí˜¸ ì…ë ¥ (ë³µìˆ˜ ì„ íƒ ì‹œ ì½¤ë§ˆë¡œ êµ¬ë¶„): ")
        try:
            user_choices = [options[int(i.strip()) - 1] for i in user_input.split(",")]
        except:
            print("âš ï¸ ì…ë ¥ ì˜¤ë¥˜")
            return False

        if set(user_choices) == set(correct_answers):
            print("âœ… ì •ë‹µ!")
            return True
        else:
            print(f"âŒ ì˜¤ë‹µ! ì •ë‹µì€ {', '.join(correct_answers)}")
            return False

# ì‹¤í–‰
score = 0
total = 0
while True:
    result = ask_question()
    total += 1
    if result:
        score += 1
    print(f"ğŸ“Š í˜„ì¬ ì •ë‹µë¥ : {score}/{total} ({score/total*100:.1f}%)")

    cont = input("\nê³„ì† í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ")
    if cont.lower() != "y":
        break
